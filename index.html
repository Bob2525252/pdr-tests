<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тести ПДР</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }
        
        .screen {
            display: none;
            padding: 16px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }
        
        .screen.active {
            display: block;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 16px;
            text-align: center;
            color: #2196F3;
        }
        
        h2 {
            font-size: 20px;
            margin-bottom: 12px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: #1976D2;
        }
        
        .btn-secondary {
            background-color: #E0E0E0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #BDBDBD;
        }
        
        .btn-danger {
            background-color: #F44336;
        }
        
        .btn-danger:hover {
            background-color: #D32F2F;
        }
        
        .btn-success {
            background-color: #4CAF50;
        }
        
        .btn-success:hover {
            background-color: #388E3C;
        }
        
        .category-item {
            padding: 16px;
            margin-bottom: 12px;
            background-color: #E3F2FD;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .category-item:hover {
            background-color: #BBDEFB;
        }
        
        .question-container {
            margin-bottom: 24px;
        }
        
        .question-image {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            margin-bottom: 12px;
            background-color: #E0E0E0;
            border-radius: 8px;
        }
        
        .answer-option {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background-color: #E3F2FD;
            border: 2px solid #E3F2FD;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .answer-option:hover {
            background-color: #BBDEFB;
            border-color: #BBDEFB;
        }
        
        .answer-option.selected {
            background-color: #2196F3;
            border-color: #2196F3;
            color: white;
        }
        
        .answer-option.correct {
            background-color: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }
        
        .answer-option.incorrect {
            background-color: #F44336;
            border-color: #F44336;
            color: white;
        }
        
        .progress-container {
            height: 8px;
            background-color: #E0E0E0;
            border-radius: 4px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #2196F3;
            width: 0%;
            transition: width 0.3s;
        }
        
        .timer-container {
            text-align: center;
            margin-bottom: 16px;
        }
        
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }
        
        .timer.timer-warning {
            color: #F44336;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
        }
        
        .navigation-buttons .btn {
            width: 48%;
        }
        
        .result-container {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background-color: #E3F2FD;
            border-radius: 8px;
        }
        
        .stats-bar-container {
            height: 24px;
            background-color: #E0E0E0;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .stats-bar {
            height: 100%;
            background-color: #2196F3;
            width: 0%;
        }
        
        .weak-topic {
            padding: 12px;
            margin-bottom: 8px;
            background-color: #FFEBEE;
            border-radius: 8px;
            color: #D32F2F;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            width: 80%;
            max-width: 400px;
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .modal-buttons .btn {
            width: 48%;
        }
        
        .hint-container {
            margin-top: 16px;
            padding: 12px;
            background-color: #FFF9C4;
            border-radius: 8px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Головний екран -->
    <div id="main-screen" class="screen active">
        <h1>Офіційні тести ПДР<br>Від Академії ВодіїВ</h1>
        <button id="start-exam-btn" class="btn" onclick="startExam()">Скласти іспит</button>
        <button id="category-tests-btn" class="btn" onclick="showCategories()">Тести по темах</button>
        <button id="results-btn" class="btn" onclick="showResults()">Мої результати</button>
    </div>
    
    <!-- Екран категорій -->
    <div id="categories-screen" class="screen">
        <h1>Виберіть тему</h1>
        <div id="categories-container">
            <!-- Категорії будуть додані через JavaScript -->
        </div>
        <button class="btn btn-secondary" onclick="showMainScreen()">Назад</button>
    </div>
    
    <!-- Екран тесту -->
    <div id="test-screen" class="screen">
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        
        <div class="timer-container">
            <div id="timer" class="timer">20:00</div>
        </div>
        
        <div id="question-container" class="question-container">
            <h2 id="question-text">Текст питання</h2>
            <img id="question-image" class="question-image" src="https://placehold.co/600x200" alt="Зображення до питання">
            
            <div id="answers-container">
                <!-- Варіанти відповідей будуть додані через JavaScript -->
            </div>
            
            <div id="hint-container" class="hint-container">
                <h3>Підказка:</h3>
                <p id="hint-text"></p>
            </div>
        </div>
        
        <div class="navigation-buttons">
            <button id="prev-btn" class="btn btn-secondary" onclick="showPreviousQuestion()">Попереднє</button>
            <button id="next-btn" class="btn" onclick="showNextQuestion()">Наступне</button>
        </div>
        
        <button id="finish-btn" class="btn btn-success" onclick="finishTest()" style="display: none;">Завершити тест</button>
        <button id="exit-btn" class="btn btn-danger" onclick="confirmExitTest()">Вийти з тесту</button>
    </div>
    
    <!-- Екран результатів тесту -->
    <div id="results-screen" class="screen">
        <h1>Результати тесту</h1>
        
        <div class="result-container">
            <p id="score-text">Ви відповіли правильно на 0 з 0 питань</p>
            <p id="percentage-text">0% правильних відповідей</p>
            <div id="result-message"></div>
        </div>
        
        <button class="btn" onclick="showMainScreen()">На головну</button>
    </div>
    
    <!-- Екран статистики -->
    <div id="stats-screen" class="screen">
        <h1>Моя статистика</h1>
        
        <h2>Загальна успішність</h2>
        <div class="stats-item">
            <span>Загальний відсоток правильних відповідей:</span>
            <span id="overall-success">0%</span>
        </div>
        <div class="stats-bar-container">
            <div id="overall-bar" class="stats-bar" style="width: 0%;"></div>
        </div>
        
        <div class="stats-item">
            <span>Пройдено тестів:</span>
            <span id="tests-completed">0</span>
        </div>
        
        <div class="stats-item">
            <span>Правильних відповідей:</span>
            <span id="correct-answers">0 з 0</span>
        </div>
        
        <h2>Теми, які потребують покращення</h2>
        <div id="weak-topics-container">
            <!-- Слабкі теми будуть додані через JavaScript -->
        </div>
        
        <button class="btn btn-secondary" onclick="showMainScreen()">Назад</button>
    </div>
    
    <!-- Модальне вікно для підтвердження виходу з тесту -->
    <div id="exit-modal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">Вийти з тесту?</h2>
            <p>Ваш прогрес буде втрачено.</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="hideExitModal()">Скасувати</button>
                <button class="btn btn-danger" onclick="exitTest()">Вийти</button>
            </div>
        </div>
    </div>
    
    <script>
        // Глобальні змінні
        let examMode = false;
        let currentTest = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval = null;
        let timeLeft = 0;
        let userStats = {
            testsCompleted: 0,
            totalQuestions: 0,
            correctAnswers: 0,
            categoryStats: {}
        };
        
        // Категорії тестів
        const categories = [
            { id: 1, title: "Загальні положення, терміни та визначення" },
            { id: 2, title: "Обов'язки і права водіїв" },
            { id: 3, title: "Рух транспортних засобів із спеціальними сигналами" },
            { id: 4, title: "Обов'язки пішоходів" },
            { id: 5, title: "Регулювання дорожнього руху" },
            { id: 6, title: "Попереджувальні сигнали" },
            { id: 7, title: "Початок руху та зміна його напрямку" },
            { id: 8, title: "Розташування транспортних засобів на дорозі" },
            { id: 9, title: "Швидкість руху" },
            { id: 10, title: "Дистанція, інтервал, зустрічний роз'їзд" }
        ];
        
        // Функція для генерації питань (замініть на реальні дані)
        function generateQuestions(categoryId = null, count = 20) {
            const questions = [];
            
            // Генеруємо випадкові питання
            for (let i = 0; i < count; i++) {
                const category = categoryId ? 
                    categories.find(c => c.id === categoryId) : 
                    categories[Math.floor(Math.random() * categories.length)];
                
                questions.push({
                    id: i + 1,
                    text: `Питання ${i + 1} з категорії "${category.title}"`,
                    image: "https://placehold.co/600x200",
                    answers: [
                        { id: 1, text: `Варіант відповіді 1` },
                        { id: 2, text: `Варіант відповіді 2` },
                        { id: 3, text: `Варіант відповіді 3` },
                        { id: 4, text: `Варіант відповіді 4` }
                    ],
                    correctAnswer: Math.floor(Math.random() * 4) + 1,
                    hint: `Підказка для питання ${i + 1}`,
                    category: category.id,
                    categoryTitle: category.title
                });
            }
            
            return questions;
        }
        
        // Функція для генерації питань для екзамену
        function generateExamQuestions() {
            return generateQuestions(null, 20);
        }
        
        // Функція для показу головного екрану
        function showMainScreen() {
            hideAllScreens();
            document.getElementById('main-screen').classList.add('active');
        }
        
        // Функція для показу екрану категорій
        function showCategories() {
            hideAllScreens();
            document.getElementById('categories-screen').classList.add('active');
            
            // Заповнюємо контейнер категоріями
            const categoriesContainer = document.getElementById('categories-container');
            categoriesContainer.innerHTML = '';
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-item';
                categoryElement.textContent = category.title;
                categoryElement.onclick = function() {
                    startCategoryTest(category.id);
                };
                
                categoriesContainer.appendChild(categoryElement);
            });
        }
        
        // Функція для початку тесту по категорії
        function startCategoryTest(categoryId) {
            examMode = false;
            const category = categories.find(c => c.id === categoryId);
            
            // Генеруємо питання для вибраної категорії
            const questions = generateQuestions(categoryId, 10);
            
            startTest(questions);
        }
        
        // Функція для початку екзамену
        function startExam() {
            examMode = true;
            startTest(generateExamQuestions());
        }
        
        // Функція для початку тесту
        function startTest(questions) {
            currentTest = {
                questions: questions,
                startTime: new Date()
            };
            
            currentQuestionIndex = 0;
            userAnswers = new Array(questions.length).fill(null);
            
            hideAllScreens();
            document.getElementById('test-screen').classList.add('active');
            
            // Показуємо перше питання
            showQuestion(0);
            
            // Запускаємо таймер
            startTimer();
        }
        
        // Функція для показу питання
        function showQuestion(index) {
            if (index < 0 || index >= currentTest.questions.length) {
                return;
            }
            
            currentQuestionIndex = index;
            const question = currentTest.questions[index];
            
            // Оновлюємо прогрес
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${((index + 1) / currentTest.questions.length) * 100}%`;
            
            // Заповнюємо дані питання
            document.getElementById('question-text').textContent = question.text;
            document.getElementById('question-image').src = question.image;
            
            // Заповнюємо варіанти відповідей
            const answersContainer = document.getElementById('answers-container');
            answersContainer.innerHTML = '';
            
            question.answers.forEach(answer => {
                const answerElement = document.createElement('button');
                answerElement.className = 'answer-option';
                answerElement.textContent = answer.text;
                answerElement.dataset.answerId = answer.id;
                
                // Якщо користувач вже відповів на це питання
                if (userAnswers[index] === answer.id) {
                    answerElement.classList.add('selected');
                }
                
                answerElement.onclick = function() {
                    selectAnswer(answer.id);
                };
                
                answersContainer.appendChild(answerElement);
            });
            
            // Оновлюємо кнопки навігації
            document.getElementById('prev-btn').disabled = index === 0;
            
            if (index === currentTest.questions.length - 1) {
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('finish-btn').style.display = 'block';
            } else {
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('finish-btn').style.display = 'none';
            }
            
            // Сховати підказку
            document.getElementById('hint-container').style.display = 'none';
        }
        
        // Функція для вибору відповіді
        function selectAnswer(answerId) {
            userAnswers[currentQuestionIndex] = answerId;
            
            // Оновлюємо вигляд варіантів відповідей
            const answerOptions = document.querySelectorAll('.answer-option');
            answerOptions.forEach(option => {
                option.classList.remove('selected');
                if (parseInt(option.dataset.answerId) === answerId) {
                    option.classList.add('selected');
                }
            });
            
            // Перевіряємо правильність відповіді
            const question = currentTest.questions[currentQuestionIndex];
            if (answerId !== question.correctAnswer) {
                // Показуємо підказку для неправильної відповіді
                document.getElementById('hint-text').textContent = question.hint;
                document.getElementById('hint-container').style.display = 'block';
            } else {
                document.getElementById('hint-container').style.display = 'none';
            }
        }
        
        // Функція для показу наступного питання
        function showNextQuestion() {
            if (currentQuestionIndex < currentTest.questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }
        
        // Функція для показу попереднього питання
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }
        
        // Функція для запуску таймера
        function startTimer() {
            timeLeft = 1200; // 20 хвилин у секундах
            updateTimerDisplay();
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishTest();
                } else if (timeLeft <= 60) {
                    // Додаємо червоний колір, коли залишається менше хвилини
                    document.getElementById('timer').classList.add('timer-warning');
                }
            }, 1000);
        }
        
        // Оновити відображення таймера
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Зупинити таймер
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        // Функція для приховування всіх екранів
        function hideAllScreens() {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
        }
        
        // Завантаження статистики при запуску
        function loadStats() {
            const savedStats = localStorage.getItem('pdrTestStats');
            if (savedStats) {
                userStats = JSON.parse(savedStats);
            }
        }
        
        // Збереження статистики
        function saveStats() {
            localStorage.setItem('pdrTestStats', JSON.stringify(userStats));
        }
        
        // Завершити тест
        function finishTest() {
            stopTimer();
            
            // Підраховуємо результати
            let correctCount = 0;
            const categoryStats = {};
            
            userAnswers.forEach((answer, index) => {
                const question = currentTest.questions[index];
                if (answer === question.correctAnswer) {
                    correctCount++;
                }
                
                // Якщо це екзаменаційний тест, оновлюємо статистику по категоріях
                if (examMode && question.category) {
                    if (!categoryStats[question.category]) {
                        categoryStats[question.category] = {
                            title: question.categoryTitle,
                            total: 0,
                            correct: 0
                        };
                    }
                    
                    categoryStats[question.category].total++;
                    if (answer === question.correctAnswer) {
                        categoryStats[question.category].correct++;
                    }
                }
            });
            
            // Оновлюємо статистику користувача
            userStats.testsCompleted++;
            userStats.totalQuestions += currentTest.questions.length;
            userStats.correctAnswers += correctCount;
            
            // Оновлюємо статистику по категоріях
            if (examMode) {
                Object.keys(categoryStats).forEach(categoryId => {
                    if (!userStats.categoryStats[categoryId]) {
                        userStats.categoryStats[categoryId] = {
                            title: categoryStats[categoryId].title,
                            total: 0,
                            correct: 0
                        };
                    }
                    
                    userStats.categoryStats[categoryId].total += categoryStats[categoryId].total;
                    userStats.categoryStats[categoryId].correct += categoryStats[categoryId].correct;
                });
            }
            
            // Зберігаємо статистику
            saveStats();
            
            // Показуємо результати
            showTestResults(correctCount, currentTest.questions.length, categoryStats);
        }
        
        // Показати результати тесту
        function showTestResults(correctCount, totalCount, categoryStats) {
            hideAllScreens();
            document.getElementById('results-screen').classList.add('active');
            
            const percentage = Math.round((correctCount / totalCount) * 100);
            
            document.getElementById('score-text').textContent = `Ви відповіли правильно на ${correctCount} з ${totalCount} питань`;
            document.getElementById('percentage-text').textContent = `${percentage}% правильних відповідей`;
            
            const resultMessage = document.getElementById('result-message');
            if (examMode) {
                if (percentage >= 90) {
                    resultMessage.innerHTML = '<h3 style="color: #4CAF50;">Відмінно! Ви склали іспит.</h3>';
                } else if (percentage >= 80) {
                    resultMessage.innerHTML = '<h3 style="color: #8BC34A;">Добре! Ви склали іспит.</h3>';
                } else if (percentage >= 70) {
                    resultMessage.innerHTML = '<h3 style="color: #FFC107;">Задовільно. Ви склали іспит.</h3>';
                } else {
                    resultMessage.innerHTML = '<h3 style="color: #F44336;">На жаль, ви не склали іспит. Спробуйте ще раз.</h3>';
                }
            } else {
                if (percentage >= 90) {
                    resultMessage.innerHTML = '<h3 style="color: #4CAF50;">Відмінний результат!</h3>';
                } else if (percentage >= 70) {
                    resultMessage.innerHTML = '<h3 style="color: #8BC34A;">Хороший результат!</h3>';
                } else if (percentage >= 50) {
                    resultMessage.innerHTML = '<h3 style="color: #FFC107;">Непоганий результат, але варто повторити матеріал.</h3>';
                } else {
                    resultMessage.innerHTML = '<h3 style="color: #F44336;">Вам потрібно більше практики.</h3>';
                }
            }
        }
        
        // Показати екран результатів
        function showResults() {
            hideAllScreens();
            document.getElementById('stats-screen').classList.add('active');
            
            // Оновлюємо статистику
            const overallSuccess = userStats.totalQuestions > 0 
                ? Math.round((userStats.correctAnswers / userStats.totalQuestions) * 100) 
                : 0;
            
            document.getElementById('overall-success').textContent = `${overallSuccess}%`;
            document.getElementById('overall-bar').style.width = `${overallSuccess}%`;
            document.getElementById('tests-completed').textContent = userStats.testsCompleted;
            document.getElementById('correct-answers').textContent = `${userStats.correctAnswers} з ${userStats.totalQuestions}`;
            
            // Показуємо слабкі теми
            const weakTopicsContainer = document.getElementById('weak-topics-container');
            weakTopicsContainer.innerHTML = '';
            
            const categoryStats = userStats.categoryStats;
            const weakTopics = [];
            
            Object.keys(categoryStats).forEach(categoryId => {
                const category = categoryStats[categoryId];
                const successRate = category.total > 0 ? (category.correct / category.total) * 100 : 0;
                
                if (successRate < 70 && category.total >= 5) {
                    weakTopics.push({
                        title: category.title,
                        successRate: successRate
                    });
                }
            });
            
            if (weakTopics.length > 0) {
                weakTopics.sort((a, b) => a.successRate - b.successRate);
                
                weakTopics.forEach(topic => {
                    const topicElement = document.createElement('div');
                    topicElement.className = 'weak-topic';
                    topicElement.textContent = `${topic.title} - ${Math.round(topic.successRate)}% успішності`;
                    weakTopicsContainer.appendChild(topicElement);
                });
            } else {
                const message = document.createElement('p');
                message.textContent = 'Немає тем, які потребують покращення, або недостатньо даних.';
                weakTopicsContainer.appendChild(message);
            }
        }
        
        // Показати модальне вікно для підтвердження виходу з тесту
        function confirmExitTest() {
            document.getElementById('exit-modal').style.display = 'flex';
        }
        
        // Сховати модальне вікно
        function hideExitModal() {
            document.getElementById('exit-modal').style.display = 'none';
        }
        
        // Вийти з тесту
        function exitTest() {
            hideExitModal();
            showMainScreen();
        }
        
        // Функція для відлагодження
        function debugButtons() {
            console.log("Додаємо обробники подій для кнопок");
            
            // Додаємо обробники подій для всіх кнопок
            document.getElementById('start-exam-btn').onclick = function() {
                console.log('Кнопка "Скласти іспит" натиснута');
                startExam();
            };
            
            document.getElementById('category-tests-btn').onclick = function() {
